# -*- coding: utf-8 -*-
"""
Ğ¤ĞĞ™Ğ›: finalize_results.py

ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ:
    - Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ¾Ñ†ĞµĞ½ĞºÑƒ Ğ²Ğ»Ğ¸ÑĞ½Ğ¸Ñ ÑÑ‚Ğ°Ñ‚ÑŒĞ¸ (Ğ½Ğ¸Ğ·ĞºĞ¾Ğµ, ÑÑ€ĞµĞ´Ğ½ĞµĞµ, Ğ²Ñ‹ÑĞ¾ĞºĞ¾Ğµ)
    - ĞĞ±ÑŠĞµĞ´Ğ¸Ğ½ÑĞµÑ‚ Ğ²ÑĞµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ² Ğ¸Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ñ‹Ğ¹ CSV
"""

import pandas as pd

# â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
# ğŸ“¥ Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
# â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

df = pd.read_csv("data/articles_clustered.csv", encoding="utf-8")

# â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
# ğŸ” ĞÑ†ĞµĞ½ĞºĞ° ÑÑ‚ĞµĞ¿ĞµĞ½Ğ¸ Ğ²Ğ»Ğ¸ÑĞ½Ğ¸Ñ
# â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

def estimate_influence(text):
    """
    ĞŸÑ€Ğ¾ÑÑ‚Ğ°Ñ ÑĞ²Ñ€Ğ¸ÑÑ‚Ğ¸ĞºĞ°:
    - Ğ’Ñ‹ÑĞ¾ĞºĞ¾Ğµ Ğ²Ğ»Ğ¸ÑĞ½Ğ¸Ğµ: Ğ´Ğ»Ğ¸Ğ½Ğ° Ñ‚ĞµĞºÑÑ‚Ğ° > 300 Ğ¸Ğ»Ğ¸ ĞµÑÑ‚ÑŒ ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ ÑĞ»Ğ¾Ğ²Ğ°
    - Ğ¡Ñ€ĞµĞ´Ğ½ĞµĞµ: 150â€“300
    - ĞĞ¸Ğ·ĞºĞ¾Ğµ: < 150
    """
    text = str(text)
    length = len(text)

    high_keywords = ["Ğ¿Ñ€ĞµĞ·Ğ¸Ğ´ĞµĞ½Ñ‚", "Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€", "Ğ¿Ñ€Ğ¾Ñ‚ĞµÑÑ‚", "ĞºÑ€Ğ¸Ğ·Ğ¸Ñ", "ÑĞºĞ°Ğ½Ğ´Ğ°Ğ»", "Ñ€ĞµÑ„Ğ¾Ñ€Ğ¼Ğ°"]
    count_keywords = sum(1 for word in high_keywords if word in text.lower())

    if length > 300 or count_keywords >= 2:
        return "Ğ²Ñ‹ÑĞ¾ĞºĞ¾Ğµ"
    elif length > 150:
        return "ÑÑ€ĞµĞ´Ğ½ĞµĞµ"
    else:
        return "Ğ½Ğ¸Ğ·ĞºĞ¾Ğµ"

df["influence_score"] = df["text"].apply(estimate_influence)

# â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
# ğŸ’¾ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚
# â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

output_path = "data/articles_final.csv"
df.to_csv(output_path, index=False, encoding="utf-8-sig")

print(f"âœ… Ğ˜Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ğ°Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ°: {output_path}")
